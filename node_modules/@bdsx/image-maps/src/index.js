"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getLevelStorage = exports.getLevel = exports.getMapData = exports._getLevelStorage = exports.IMAGE_PATH = exports.LevelStorage = void 0;
const bdsx_1 = require("bdsx");
const nativeclass_1 = require("bdsx/nativeclass");
const prochacker_1 = require("bdsx/prochacker");
const core_1 = require("bdsx/core");
const map_data_1 = require("./map-data");
const common_1 = require("bdsx/common");
const level_1 = require("bdsx/bds/level");
const nbt_1 = require("bdsx/bds/nbt");
const path = require("path");
const fs = require("fs");
class LevelStorage extends nativeclass_1.NativeClass {
}
exports.LevelStorage = LevelStorage;
exports.IMAGE_PATH = path.join(process.cwd(), '../images');
if (!fs.existsSync(exports.IMAGE_PATH))
    fs.mkdirSync(exports.IMAGE_PATH);
core_1.pdb.setOptions(common_1.SYMOPT_UNDNAME);
const procHacker = prochacker_1.ProcHacker.load(path.join(__dirname, '../pdb.ini'), [
    "Level::getLevelStorage",
    "MapItemSavedData::setPixel",
    "MapItemSavedData::setLocked",
    "MapItemSavedData::getParentMapId",
    "MapItemSavedData::save"
]);
core_1.pdb.setOptions(0);
const procHackerDec = prochacker_1.ProcHacker.load(path.join(__dirname, '../pdb.ini'), [
    "?getMapSavedData@Level@@UEAAPEAVMapItemSavedData@@AEBVCompoundTag@@@Z"
]);
core_1.pdb.close();
map_data_1.MapItemSavedData.prototype.save = procHacker.js("MapItemSavedData::save", bdsx_1.RawTypeId.Void, { this: map_data_1.MapItemSavedData }, LevelStorage);
map_data_1.MapItemSavedData.prototype.setPixel = procHacker.js("MapItemSavedData::setPixel", bdsx_1.RawTypeId.Void, { this: map_data_1.MapItemSavedData }, bdsx_1.RawTypeId.Int32, bdsx_1.RawTypeId.Int32, bdsx_1.RawTypeId.Int32);
map_data_1.MapItemSavedData.prototype.setLocked = procHacker.js("MapItemSavedData::setLocked", bdsx_1.RawTypeId.Void, { this: map_data_1.MapItemSavedData });
map_data_1.MapItemSavedData.prototype.getMapId = procHacker.js("MapItemSavedData::getParentMapId", bdsx_1.RawTypeId.Bin64, { this: map_data_1.MapItemSavedData });
exports._getLevelStorage = procHacker.js("Level::getLevelStorage", LevelStorage, null, level_1.Level);
exports.getMapData = procHackerDec.js("?getMapSavedData@Level@@UEAAPEAVMapItemSavedData@@AEBVCompoundTag@@@Z", map_data_1.MapItemSavedData, null, level_1.Level, nbt_1.CompoundTag);
function getLevel() {
    return bdsx_1.serverInstance.minecraft.getLevel();
}
exports.getLevel = getLevel;
function getLevelStorage() {
    return exports._getLevelStorage(getLevel());
}
exports.getLevelStorage = getLevelStorage;
bdsx_1.bedrockServer.open.on(() => {
    require('./command');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwrQkFBZ0U7QUFDaEUsa0RBQStDO0FBQy9DLGdEQUE2QztBQUM3QyxvQ0FBZ0M7QUFDaEMseUNBQThDO0FBQzlDLHdDQUE2QztBQUM3QywwQ0FBdUM7QUFDdkMsc0NBQTJDO0FBRTNDLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFFekIsTUFBYSxZQUFhLFNBQVEseUJBQVc7Q0FBRztBQUFoRCxvQ0FBZ0Q7QUFFbkMsUUFBQSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDaEUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsa0JBQVUsQ0FBQztJQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsa0JBQVUsQ0FBQyxDQUFDO0FBRXpELFVBQUcsQ0FBQyxVQUFVLENBQUMsdUJBQWMsQ0FBQyxDQUFDO0FBQy9CLE1BQU0sVUFBVSxHQUFHLHVCQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxFQUFFO0lBQ25FLHdCQUF3QjtJQUN4Qiw0QkFBNEI7SUFDNUIsNkJBQTZCO0lBQzdCLGtDQUFrQztJQUNsQyx3QkFBd0I7Q0FDM0IsQ0FBQyxDQUFDO0FBQ0gsVUFBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsQixNQUFNLGFBQWEsR0FBRyx1QkFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsRUFBRTtJQUN0RSx1RUFBdUU7Q0FDMUUsQ0FBQyxDQUFDO0FBQ0gsVUFBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0FBRVosMkJBQWdCLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsRUFBRSxDQUFDLHdCQUF3QixFQUFFLGdCQUFTLENBQUMsSUFBSSxFQUFFLEVBQUMsSUFBSSxFQUFFLDJCQUFnQixFQUFDLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDbEksMkJBQWdCLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUMsRUFBRSxDQUFDLDRCQUE0QixFQUFFLGdCQUFTLENBQUMsSUFBSSxFQUFFLEVBQUMsSUFBSSxFQUFFLDJCQUFnQixFQUFDLEVBQUUsZ0JBQVMsQ0FBQyxLQUFLLEVBQUUsZ0JBQVMsQ0FBQyxLQUFLLEVBQUUsZ0JBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMvSywyQkFBZ0IsQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQyxFQUFFLENBQUMsNkJBQTZCLEVBQUUsZ0JBQVMsQ0FBQyxJQUFJLEVBQUUsRUFBQyxJQUFJLEVBQUUsMkJBQWdCLEVBQUMsQ0FBQyxDQUFDO0FBQzlILDJCQUFnQixDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxnQkFBUyxDQUFDLEtBQUssRUFBRSxFQUFDLElBQUksRUFBRSwyQkFBZ0IsRUFBQyxDQUFDLENBQUM7QUFFdEgsUUFBQSxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsRUFBRSxDQUFDLHdCQUF3QixFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsYUFBSyxDQUFDLENBQUM7QUFDdEYsUUFBQSxVQUFVLEdBQUcsYUFBYSxDQUFDLEVBQUUsQ0FBQyx1RUFBdUUsRUFBRSwyQkFBZ0IsRUFBRSxJQUFJLEVBQUUsYUFBSyxFQUFFLGlCQUFXLENBQUMsQ0FBQztBQUdoSyxTQUFnQixRQUFRO0lBQ3BCLE9BQU8scUJBQWMsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDL0MsQ0FBQztBQUZELDRCQUVDO0FBRUQsU0FBZ0IsZUFBZTtJQUMzQixPQUFPLHdCQUFnQixDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUZELDBDQUVDO0FBRUQsb0JBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRTtJQUN2QixPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUMifQ==